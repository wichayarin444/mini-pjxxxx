<div class="page">
  <h2>Fund Management</h2>

  <!-- Search Criteria -->
  <section class="search-section dx-card content-block">
    <h3>Search Criteria</h3>
    <form [formGroup]="searchForm" class="search-container">
      <div class="search-item">
        <label>Fund Code</label>
        <dx-text-box formControlName="fundCode" placeholder="Fund Code"></dx-text-box>
      </div>
      <div class="search-item">
        <label>AIMC Category</label>
        <dx-select-box formControlName="aimcCategory" [items]="aimcCategories" placeholder="Select..."
          [showClearButton]="true"></dx-select-box>
      </div>
      <div class="search-item date-range">
        <label>IPO Date Range</label>
        <div class="range-inputs">
          <dx-date-box formControlName="ipoFrom" type="date" displayFormat="yyyy-MM-dd"
            placeholder="Start Date"></dx-date-box>
          <span class="separator">-</span>
          <dx-date-box formControlName="ipoTo" type="date" displayFormat="yyyy-MM-dd"
            placeholder="End Date"></dx-date-box>
        </div>
      </div>
    </form>
    <div class="actions-search">
      <dx-button text="Search" type="default" stylingMode="contained" (onClick)="onSearch()"></dx-button>
    </div>
  </section>

  <!-- Fund List -->
  <section class="list-section dx-card content-block">
    <h3>Fund List</h3>
    <div class="table-actions">
      <dx-button text="+ Add New Fund" type="default" stylingMode="contained" (onClick)="startAdd()"></dx-button>
    </div>

    <dx-data-grid [dataSource]="list()" [showBorders]="true" [columnAutoWidth]="true" [rowAlternationEnabled]="true">
      <dxo-paging [pageSize]="10"></dxo-paging>
      <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[10, 20, 50]" [showInfo]="true"></dxo-pager>

      <dxi-column dataField="fundCode" caption="Fund Code"></dxi-column>
      <dxi-column dataField="nav" caption="NAV" format="#,##0.0000"></dxi-column>
      <dxi-column dataField="aimcCategory" caption="AIMC Category"></dxi-column>
      <dxi-column dataField="ipoDate" caption="IPO Date" dataType="date" format="yyyy-MM-dd"></dxi-column>
      <dxi-column dataField="frontEndFee" caption="Front-end Fee (%)" format="#,##0.00"></dxi-column>
      <dxi-column dataField="backEndFee" caption="Back-end Fee (%)" format="#,##0.00"></dxi-column>
      <dxi-column caption="Actions" cellTemplate="actionsCell" [width]="100" alignment="center"></dxi-column>

      <div *dxTemplate="let d of 'actionsCell'">
        <div class="action-buttons">
          <dx-button icon="edit" stylingMode="text" (onClick)="startEdit(d.data)"></dx-button>
          <dx-button icon="trash" stylingMode="text" type="danger" (onClick)="remove(d.data.fundCode)"></dx-button>
        </div>
      </div>
    </dx-data-grid>
  </section>

  <!-- Add/Edit Modal -->
  <dx-popup *ngIf="isBrowser()" [visible]="showModal()" [title]="'Add/Edit Fund'" [showTitle]="true"
    [dragEnabled]="false" [hideOnOutsideClick]="true" [width]="600" [height]="'auto'" (onHiding)="closeModal()">

    <div *dxTemplate="let data of 'content'">
      <form [formGroup]="form" class="popup-form">
        <div class="field">
          <label>Fund Code</label>
          <dx-text-box formControlName="fundCode" placeholder="Fund Code"></dx-text-box>
        </div>
        <div class="field">
          <label>NAV</label>
          <dx-number-box formControlName="nav" format="#,##0.0000" [min]="0" [showSpinButtons]="true"></dx-number-box>
        </div>
        <div class="field">
          <label>AIMC Category</label>
          <dx-select-box formControlName="aimcCategory" [items]="aimcCategories"
            placeholder="Select..."></dx-select-box>
        </div>
        <div class="field">
          <label>IPO Date</label>
          <dx-date-box formControlName="ipoDate" type="date" displayFormat="yyyy-MM-dd"></dx-date-box>
        </div>
        <div class="field">
          <label>Front-end Fee (%)</label>
          <dx-number-box formControlName="frontEndFee" format="#,##0.00" [min]="0"
            [showSpinButtons]="true"></dx-number-box>
        </div>
        <div class="field">
          <label>Back-end Fee (%)</label>
          <dx-number-box formControlName="backEndFee" format="#,##0.00" [min]="0"
            [showSpinButtons]="true"></dx-number-box>
        </div>

        <div class="popup-footer">
          <dx-button text="Cancel" stylingMode="outlined" (onClick)="cancelEdit()"></dx-button>
          <dx-button text="Save Fund" type="success" stylingMode="contained" (onClick)="save()"
            [disabled]="form.invalid"></dx-button>
        </div>
      </form>
    </div>
  </dx-popup>
</div>